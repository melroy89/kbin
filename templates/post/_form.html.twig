{% set hasImage = false %}
{% if post is defined and post is not null and post.image %}
    {% set hasImage = true %}
{% endif %}

{{ form_start(form, { 'attr': {'data-controller': 'media', class: 'kbin-media mb-5' }}) }}
<div class="kbin-post-create-form my-3">
    <div class="mb-3">
        {{ form_label(form.body, 'post'|trans) }}
        {{ form_widget(form.body, {'attr': {'class': 'kbin-editor'}}) }}
    </div>

    <div class="text-end float-end">
        <div class="me-2 pt-2 float-start">
            {{ form_label(form.isAdult, '18+') }}
            <div class="input-group input-group-lg">
                {{ form_widget(form.isAdult, {name: '18+'}) }}
            </div>
        </div>

        <div class="btn-group">
            <a class="btn btn-secondary me-1" href="https://{{ kbin_domain }}{{ kbin_markdown_howto_url }}" role="button">
                <i class="fas fa-question"></i>
            </a>

            <button type="button" class="btn btn-secondary me-1 {{ hasImage ? 'd-none' : '' }}" data-bs-toggle="modal"
                    data-bs-target="#media-modal-post" data-media-target="modalButton">
                <i class="fas fa-camera"></i>
            </button>

            <button data-action="media#delete"
                    data-media-target="deleteButton"
                    data-media-url-param="{{ hasImage ? path('post_image_delete', {magazine_name: post.magazine.name, post_id: post.id}) : '' }}"
                    type="button"
                    class="btn-close me-1 {{ hasImage ? '' : 'd-none' }}"
                    aria-label="Close"></button>

            {% if hasImage %}
                <img data-media-target="thumb" src="{{ asset(post.image.filePath) | imagine_filter('post_thumb') }}" alt="" class="me-2"/>
            {% else %}
                <canvas data-media-target="canvas" class="d-none me-2"></canvas>
            {% endif %}

            {{ form_widget(form.submit, { 'label': 'done'|trans, 'attr': {'class': 'kbin-post-send btn-primary'} }) }}
        </div>
    </div>
</div>

<div class="clearfix"></div>

<div id="media-modal-post" class="modal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Dodaj zdjÄ™cie <strike>lub film</strike></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" data-media-target="close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-4">
                    <small>wklej adres</small>
                    <small class="ms-2 font-weight-bold" data-action="click->media#add">wybierz plik</small>
                </div>
                <div class="input-group input-group-lg me-2">
                    {{ form_widget(form.image, {'attr':{ 'class': 'form-control', 'data-action': 'media#add', 'data-media-target': 'fileInput' }}) }}
                </div>
            </div>
        </div>
    </div>
</div>
{{ form_end(form) }}
