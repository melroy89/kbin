{% extends 'base.html.twig' %}

{% block title %}
    {% if is_sub_page() %}
        {{ 'topbar.subscriptions'|trans }} - {{ 'posts'|trans }}
    {% elseif is_mod_page() %}
        {{ 'topbar.moderated'|trans }} - {{ 'posts'|trans }}
    {% elseif is_magazine_page() %}
        {{ magazine.title }} - {{ 'posts'|trans }}
    {% else %}
        {{ 'posts'|trans ~ ' - ' ~ kbin_title }}
    {% endif %}
{% endblock %}
{% block description %}{{ magazine is defined ? magazine.description ? get_short_desc(magazine.description) : '' : kbin_description }}{% endblock %}
{% block image %}{{ magazine is defined ? magazine.cover ? uploaded_asset(magazine.cover.filePath) : '' : '' }}{% endblock %}

    {% block body %}
        <div class="kbin-posts-page">
            <section class="kbin-post-wrapper kbin-comment-wrapper">
                {% include '_layout/_filters.html.twig' %}
                {% include '_layout/_flash.html.twig' %}
                {% if magazine is defined and magazine.isAdult and (not app.user or app.user.hideAdult) %}
                    {% include '_layout/_adult.html.twig' %}
                {% else %}
                    {% if magazine is defined and is_granted('create_content', magazine) %}
                        {{ component('post_form', {magazine: magazine}) }}
                    {% elseif magazine is defined %}
                        <div class="alert alert-secondary text-muted my-3" role="alert">
                            {% if not app.user %}
                                {{ 'login_to_post'|trans({'%link_start%' : '<a class="font-weight-bold" href="'~path('app_login')~'">', '%link_end%' : '</a>'}) | raw }}
                            {% else %}
                                {{ 'cannot_add_post'|trans }}
                            {% endif %}
                        </div>
                    {% endif %}

                    {% include 'post/_list.html.twig' %}
                {% endif %}
            </section>
        </div>
    {% endblock %}

{% block sidebar %}
    {{ parent() }}

    {% if is_magazine_page() %}
        {% include 'magazine/_sidebar.html.twig' %}
    {% endif %}
{% endblock %}
